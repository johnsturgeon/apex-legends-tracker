{% extends 'base.html' %}
{% set refresh=False %}
{% set page_title="Friends of the Apex Legends API: Profile Page" %}
{% set player = player_data.player %}
{% set player_uid = player.global_info.uid %}
{% set player_name = player.global_info.name %}
{% set player_totals = db_helper.get_player_totals(
                      player_uid,
                      [tracker_key],
                      active_legends_only=True)  -%}
{% block content %}
    <script type="text/javascript" src="{{ url_for('static', filename='tracker_detail.js') }}">
    </script>
    <script>
        $(document).ready(function(){
            setDefaultValues()
            refreshTracker({{ player_uid }}, '{{ tracker_key }}')
            setInterval("refreshTracker({{ player_uid }}, '{{ tracker_key }}')", 5000)
        })
    </script>

    <div class="player_profile_container">
        <div class="player_profile_card shadow_container">
            <div class="item player_profile_name">
                {{ player.global_info.name }}
            </div>
            <div class="profile_stat_outer_container">
                <div class="circle_item">
                    {% set tracker_detail = player_totals[tracker_key] %}
                    {{ macros.circle_total(tracker_key | upper , tracker_detail['total'], "updating...") }}
                </div>
                <div class="profile_total_stat_item">
                    <div class="profile_stat_inner_container">
                        {% for legend in tracker_detail['legends'] %}
                            {% set tracker_total = legend['total'] %}
                            {{ macros.tracker_detail_progress_container(
                                player_uid=player_uid,
                                legend_name=legend.name,
                                tracker_key=tracker_key) }}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div class="shadow_container" style="flex-direction: column">
            <div class="item">
                CURRENT: All is good, the value should match your totals in Apex Legends
            </div>
            <div class="item">
                <span class="progress-bar-tracker-state-old">OUTDATED:</span> A legend's tracker exists, has been seen, but is outdated.<br />
                To Fix: Swap to that legend, add that tracker, and go back to the lobby.  Wait a few seconds and it should automatically update!
            </div>
            <div class="item">
                <span class="progress-bar-tracker-state-missing">MISSING:</span> A legend's tracker is missing (that means that we haven't seen that tracker on that specific
                legend yet), this could be because you don't have that tracker.
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <div class="chart" id="spline">
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
