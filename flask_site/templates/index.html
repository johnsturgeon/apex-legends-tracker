{% extends 'base.html' %}
{% set hide_header=True %}
{% set page_title="Friends of the Apex Legends API: Home Page" %}
{% set max_games = db_helper.get_max_category_for_day('games', day) %}
{% set max_avg_kills = db_helper.get_max_category_avg_for_day('kills', day) | round(2) %}
{% set max_avg_damage = db_helper.get_max_category_avg_for_day('damage', day) | round(0) | int %}
{% set max_wins = db_helper.get_max_category_for_day('wins', day) %}
{% block content %}
    <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/bundle.js"></script>
    <div class="item">
        <div class="shadow_container no_margin">
            <div class="item header_label">
                <span class="header_item first_header_item">
                    <a href="#" id="date_picker">Choose Date</a> (currently: {{ day }})
                </span>
            </div>
            <div class="item header_label last_header_label" style="text-align: right">
            <span class="header_item last_header_item">
                <a href="https://github.com/johnsturgeon/apex-legends-tracker/blob/main/CHANGELOG.md" target="_blank">What's New</a>
            </span>
            </div>
        </div>
        <div class="shadow_container">
            <div class="container no_margin">
                <div class="break no_padding"></div>
                {% for player in players %}
                    {% set player_data = player_data_dict[player['name']] %}
                    {% set games_played=player_data.games_played(day) | length -%}
                    {% set kill_avg=player_data.category_day_average(day, 'kills') | round(2) -%}
                    {% set wins=player_data.category_total(day, 'wins') -%}
                    {% set damage=player_data.category_day_average(day, 'damage') | round(0) | int -%}
                    <div class="item">
                        <div class="{% if player_data.is_online() %}online{% endif %}" style="display: flex; justify-content: space-between">
                            <span><a href="{{ url_for('profile', player_uid=player["uid"] ) }}">{{ player["name"] }}</a><br></span>
                            <span class="{% if player_data.is_online() %}online_small_font{% endif %}">
                                {% if player_data.is_online() %}online{% endif %}
                            </span>
                        </div>
                    </div>
                    {{ macros.progress_container("Games", games_played, max_games, show_total=False) }}
                    {{ macros.progress_container("Wins", wins, max_wins, highlight_max=True, show_total=False) }}
                    {{ macros.progress_container("Kill/g", kill_avg, max_avg_kills, highlight_max=True, show_total=False) }}
                    {{ macros.progress_container("Damage/g", damage, max_avg_damage, highlight_max=True, show_total=False) }}
                    <div class="break no_padding"></div>
                {% endfor %}
            </div>
        </div>
    </div>
    <script>
        const picker = new Litepicker({
            element: document.getElementById('date_picker'),
            highlightedDays: ['{{ day }}'],
            maxDate: new Date()
        });
        picker.on('selected', (date1) => {
            window.location.href='/' + date1.format('YYYY-MM-DD')
        });
    </script>
{% endblock %}
